# üå§Ô∏è Weather Monthly Pipeline

–ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –¥–ª—è —Ç—Ä—ë—Ö –≥–æ—Ä–æ–¥–æ–≤ (–ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –°–æ—á–∏), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ HDFS, —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ Telegram.

üëâ –ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](index.md)

---

## üìÅ –ß—Ç–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| docker-compose.yml | –û—Ä–∫–µ—Å—Ç—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ |
| requirements.txt | –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| README.md | –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É |
| dags/weather_monthly_dag.py | DAG Airflow |
| telegram-bot/bot.py | –û—Å–Ω–æ–≤–Ω–æ–π Telegram-–±–æ—Ç |
| telegram-bot/send_plots.py | –î–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ Airflow |
| telegram-bot/weather_utils.py | –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: HDFS, –≥—Ä–∞—Ñ–∏–∫, —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å |
| docs/ | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ |

---

## üß© –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –∏–∑ [Meteostat](https://dev.meteostat.net/) 
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ HDFS —á–µ—Ä–µ–∑ WebHDFS REST API
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø–æ –¥–Ω—è–º (`matplotlib`, `seaborn`)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
weather-plots/
‚îú‚îÄ‚îÄ .env # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml # –û—Ä–∫–µ—Å—Ç—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ requirements.txt # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ dags/ # DAG'–∏ Airflow
‚îÇ ‚îî‚îÄ‚îÄ weather_monthly_dag.py
‚îú‚îÄ‚îÄ telegram-bot/
‚îÇ ‚îú‚îÄ‚îÄ bot.py # –ó–∞–ø—É—Å–∫–∞–µ–º—ã–π –±–æ—Ç
‚îÇ ‚îú‚îÄ‚îÄ send_plots.py # CLI-—Å–∫—Ä–∏–ø—Ç –¥–ª—è Airflow
‚îÇ ‚îî‚îÄ‚îÄ weather_utils.py # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ hdfs-data/ # –î–∞–Ω–Ω—ã–µ NameNode –∏ DataNode
‚îÇ ‚îú‚îÄ‚îÄ namenode/
‚îÇ ‚îî‚îÄ‚îÄ datanode/
‚îú‚îÄ‚îÄ logs/ # –õ–æ–≥–∏ Airflow
‚îú‚îÄ‚îÄ data/ # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ docs/ # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```


---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker + Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Telegram Bot Token (–ø–æ–ª—É—á–∞–µ—Ç—Å—è —É [@BotFather](https://t.me/BotFather)) 
- Chat ID (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å, –Ω–∞–ø–∏—Å–∞–≤ `/start` —Å–≤–æ–µ–º—É –±–æ—Ç—É)

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/yourusername/weather-plots.git 
cd weather-plots
```

### 2. –°–æ–∑–¥–∞–π .env —Ñ–∞–π–ª

–ü—Ä–∏–º–µ—Ä .env:
```bash
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_CHAT_ID=your_chat_id
AIRFLOW_UID=50000
```

---

### üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ docker-compose.

üí° –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ Airflow –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ requests + WebHDFS REST API 

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ü–æ–¥–Ω–∏–º–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
docker-compose up -d
```

### 2. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º DAG –≤ UI

–ü–µ—Ä–µ–π–¥–∏ –≤ Airflow Webserver ‚Üí –∞–∫—Ç–∏–≤–∏—Ä—É–π DAG weather_monthly_pipeline

---

## üìä –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

DAG –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é:

–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Meteostat
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ HDFS: /raw/weather/{{ ds }}/raw_weather.json
–ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ HDFS
–°—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø–æ –¥–Ω—è–º
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ Telegram

---

## üì¶ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WebHDFS REST API –≤–º–µ—Å—Ç–æ hdfscli –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ Airflow
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ HDFS
- –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç python-telegram-bot==13.15
- Airflow 2.9.3 + CeleryExecutor + Redis + PostgreSQL

---

## üì£ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞


 /start | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–æ—Ç–∞ 
 --- | --- 
 /forecast | –í—ã–≤–æ–¥ –≥—Ä–∞—Ñ–∏–∫–∞ 
 /weather <–≥–æ—Ä–æ–¥> | –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–≥–æ–¥–µ –≤ –≥–æ—Ä–æ–¥–µ 
 /choose | –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ –∫–Ω–æ–ø–∫–∞–º–∏ 

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

- —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
- —Å–¥–µ–ª–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–≤–æ–¥–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ –≥–æ—Ä–æ–¥–∞–º –ø–æ –≤—ã–±–æ—Ä—É –∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–≥–æ–¥–µ (–Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∑–∞ –ø—Ä–æ—à–µ–¥—à–∏–π –º–µ—Å—è—Ü => —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏)
- "—Å–ø—Ä—è—Ç–∞—Ç—å" –≤–≤–æ–¥–∏–º—ã–µ –∫–æ–º–∞–Ω–¥—ã, —Å–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫–∞–º–∏